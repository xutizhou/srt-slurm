name: "bs64-2p3d-h200-fp8"

model:
  path: "dsr1"
  container: "lmsysorg/sglang:v0.5.8-cu130"
  precision: "fp8"

frontend:
  nginx_container: nginx

resources:
  gpu_type: "h200"
  prefill_nodes: 2
  prefill_workers: 2
  decode_nodes: 3
  decode_workers: 3
  gpus_per_node: 8

backend:

  prefill_environment:
    SGLANG_JIT_DEEPGEMM_FAST_WARMUP: "1"
    SGLANG_DISAGGREGATION_HEARTBEAT_MAX_FAILURE: "100000"
    SGLANG_DISAGGREGATION_BOOTSTRAP_TIMEOUT: "100000"
    SGLANG_DISAGGREGATION_WAITING_TIMEOUT: "100000"

  decode_environment:
    SGLANG_JIT_DEEPGEMM_FAST_WARMUP: "1"
    SGLANG_DISAGGREGATION_HEARTBEAT_MAX_FAILURE: "100000"
    SGLANG_DISAGGREGATION_BOOTSTRAP_TIMEOUT: "100000"
    SGLANG_DISAGGREGATION_WAITING_TIMEOUT: "100000"

  sglang_config:
    prefill:
      # Model configuration
      served-model-name: "deepseek-ai/DeepSeek-R1"
      model-path: "/model/"
      skip-tokenizer-init: true
      trust-remote-code: true

      # Parallelism
      tp-size: 8
      dp-size: 1
      ep-size: 1 

      # KV cache and attention
      attention-backend: "flashinfer"

      # Radix cache disabled
      disable-radix-cache: true

      # Other flags
      # stream-interval: 50
      watchdog-timeout: 1000000
      max-running-requests: 16
      

      # Prefill-specific mode
      disaggregation-bootstrap-port: 30001
      disaggregation-mode: "prefill"
      disaggregation-transfer-backend: nixl

      # Memory and token limits
      mem-fraction-static: 0.82
      max-prefill-tokens: 32768
      chunked-prefill-size: 32768

      # Request handling
      load-balance-method: "round_robin"

    decode:
      # Model configuration
      served-model-name: "deepseek-ai/DeepSeek-R1"
      model-path: "/model/"
      skip-tokenizer-init: true
      trust-remote-code: true

      # Parallelism
      tp-size: 8
      dp-size: 1
      ep-size: 1

      # KV cache and attention
      attention-backend: "flashinfer"

      # Other flags
      disable-radix-cache: true
      stream-interval: 10
      watchdog-timeout: 1000000

      # Disagg
      disaggregation-bootstrap-port: 30001
      disaggregation-mode: "decode"
      disaggregation-transfer-backend: nixl

      context-length: 72000
      max-total-tokens: 128000 
      # Memory and token limits
      mem-fraction-static: 0.82
      max-running-requests: 128
      cuda-graph-max-bs: 128

benchmark:
  type: "sa-bench"
  isl: 8192
  osl: 1024
  concurrencies: "32x64x128"
  req_rate: "inf"

# benchmark:
#   type: "gpqa"
#   num_examples: 198
#   repeat: 4
#   num_threads: 32
#   max_tokens: 64000